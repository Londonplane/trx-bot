# 🏠 TRON能量助手本地测试指南

## 💡 为什么先做本地测试？

本地测试可以让你：
- ✅ **零成本验证** - 无需购买VPS，本地环境即可测试
- ✅ **熟悉系统** - 了解所有功能和操作流程
- ✅ **发现问题** - 在本地解决配置和操作问题
- ✅ **准备就绪** - 为后续VPS部署做好充分准备

---

## 🚀 快速开始 (预计30分钟)

### 环境要求
- Windows 10/11 或 macOS/Linux
- Python 3.8+
- 8GB+ 内存 (推荐)

### 1️⃣ 启动后端服务 (5分钟)

```bash
# 进入后端目录
cd C:\Users\wt200\trx-bot\backend

# 使用自动启动脚本 (Windows)
start_services.bat

# 或者手动启动 (如果脚本有问题)
python main.py
```

**验证**: 访问 http://localhost:8001/health 看到：
```json
{"status":"healthy","message":"API服务正常运行"}
```

### 2️⃣ 测试核心API (5分钟)

```bash
# 测试用户余额API
curl http://localhost:8001/api/users/12345/balance

# 测试供应商钱包API  
curl http://localhost:8001/api/supplier-wallets/

# 模拟用户充值
curl -X POST http://localhost:8001/api/users/12345/deposit \
  -H "Content-Type: application/json" \
  -d '{
    "tx_hash": "1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef", 
    "amount": 10.0,
    "currency": "TRX"
  }'
```

**期望结果**: 所有API都返回正确的JSON响应

### 3️⃣ 启动Telegram Bot (5分钟)

```bash
# 在项目根目录启动Bot
cd C:\Users\wt200\trx-bot
python main.py
```

**验证**: 在Telegram中向你的Bot发送 `/start`，应该看到欢迎消息

### 4️⃣ 端到端功能测试 (15分钟)

在Telegram Bot中测试：

1. **钱包管理**: 添加一个TRON地址
2. **余额查询**: 点击 "Address balance" 
3. **闪租页面**: 选择能量数量和时长
4. **模拟下单**: 观察订单创建过程

---

## 🧪 详细测试步骤

### 第一步: 系统基础验证

#### 检查服务状态
```bash
# 检查后端API
curl http://localhost:8001/health
curl http://localhost:8001/docs  # API文档

# 检查数据库  
curl http://localhost:8001/api/users/99999/balance
```

#### 预期结果
- ✅ API服务正常响应
- ✅ 数据库自动创建用户记录
- ✅ SQLite数据库文件生成 (`backend/trx_energy.db`)

### 第二步: 用户余额系统测试

#### 模拟充值流程
```bash
# 1. 查询初始余额
curl http://localhost:8001/api/users/888888/balance

# 2. 模拟充值
curl -X POST http://localhost:8001/api/users/888888/deposit \
  -H "Content-Type: application/json" \
  -d '{
    "tx_hash": "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890", 
    "amount": 50.0,
    "currency": "TRX"
  }'

# 3. 验证充值结果
curl http://localhost:8001/api/users/888888/balance

# 4. 查看余额变动记录
curl http://localhost:8001/api/users/888888/transactions
```

#### 预期结果  
- ✅ 初始余额为 0
- ✅ 充值成功返回 `"success": true`
- ✅ 余额更新为 50.0 TRX
- ✅ 有余额变动记录

### 第三步: 订单系统测试 (无TRON交易)

#### 创建测试订单
```bash
# 创建订单
curl -X POST http://localhost:8001/api/orders/ \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 888888,
    "energy_amount": 32000,
    "duration": "1h",
    "receive_address": "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"
  }'
```

#### 观察订单处理
由于本地没有真实的TRON钱包，订单会：
1. 成功创建 (状态: `pending`)
2. 正确扣减用户余额
3. 尝试处理但找不到供应商钱包 (状态: `failed`)
4. 自动退款给用户

这是**正常现象**！证明错误处理机制工作正常。

### 第四步: Telegram Bot完整测试

#### Bot交互测试
1. **启动对话**: `/start`
2. **添加地址**: 输入任意TRON地址 (如 `TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t`)
3. **余额查询**: 点击 "Address balance" (会查询真实TRON网络)
4. **闪租页面**: 
   - 选择 "65K Energy"
   - 选择 "1h duration"  
   - 查看费用计算 (约 0.043 TRX)
5. **模拟下单**: 点击 "Buy" (会提示余额不足或创建订单)

#### 预期体验
- ✅ 所有按钮和界面正常工作
- ✅ 地址验证功能正常
- ✅ 余额查询显示真实TRON网络数据
- ✅ 费用计算准确
- ✅ 订单创建流程完整

---

## 🎯 本地测试验收标准

### 核心功能验收
- [ ] **后端API**: 15个API端点全部正常响应
- [ ] **数据库**: 用户、订单数据正确存储  
- [ ] **用户系统**: 充值、余额管理功能正常
- [ ] **订单系统**: 创建、查询、状态管理正常
- [ ] **Bot界面**: 所有用户交互功能正常
- [ ] **TRON查询**: 真实区块链数据查询正常

### 错误处理验证
- [ ] **无供应商钱包**: 订单失败并自动退款
- [ ] **余额不足**: 正确提示并阻止下单  
- [ ] **无效地址**: 地址验证功能正常
- [ ] **无效参数**: API错误处理不崩溃

### 性能基准
- [ ] **API响应**: 平均响应时间 < 1秒
- [ ] **内存使用**: 系统内存使用 < 2GB
- [ ] **界面流畅**: Bot交互响应及时

---

## 🔍 故障排查

### 常见问题解决

#### 后端服务启动失败
```bash
# 检查端口占用
netstat -ano | findstr :8001  # Windows
lsof -i :8001                 # macOS/Linux

# 手动安装依赖
cd backend && pip install -r requirements.txt

# 检查Python版本
python --version  # 需要3.8+
```

#### Bot无响应  
```bash
# 检查Bot Token
grep TELEGRAM_BOT_TOKEN config.py

# 检查网络连接
ping api.telegram.org

# 重启Bot
Ctrl+C 然后重新运行 python main.py
```

#### API调用失败
```bash
# 检查服务状态
curl http://localhost:8001/health

# 查看错误日志
# 检查终端输出的错误信息

# 重启后端服务
Ctrl+C 然后重新运行
```

---

## 🎉 本地测试完成后

### 如果测试成功 ✅
恭喜！你的系统在本地完全正常工作，这意味着：
- **代码无问题** - 所有功能模块正常
- **配置正确** - 环境和依赖配置正确
- **用户体验良好** - 界面和交互流程完整
- **准备VPS部署** - 可以开始考虑购买VPS了

### 下一步建议
1. **购买VPS** - 推荐2核4G配置
2. **准备测试资金** - 每个钱包100-200 TRX用于测试
3. **配置域名** - 可选，但有利于HTTPS配置
4. **参考生产测试指南** - 按照VPS部署流程操作

### 如果遇到问题 ⚠️
1. **检查错误日志** - 查看终端输出的详细错误
2. **参考故障排查** - 使用上面的故障排查步骤
3. **重新安装依赖** - `pip install -r requirements.txt`
4. **重启服务** - 停止所有服务后重新启动

---

## 📝 测试记录模板

建议记录测试过程：

```
TRON能量助手本地测试记录
测试日期: ___________
测试人员: ___________

✅ 后端API服务启动: [ ] 成功 [ ] 失败
✅ 数据库连接正常: [ ] 成功 [ ] 失败  
✅ 用户充值功能: [ ] 成功 [ ] 失败
✅ 订单创建功能: [ ] 成功 [ ] 失败
✅ Telegram Bot: [ ] 成功 [ ] 失败
✅ 端到端流程: [ ] 成功 [ ] 失败

遇到的问题:
1. ________________
2. ________________

解决方案:
1. ________________  
2. ________________

总体评价: [ ] 完全正常 [ ] 基本正常 [ ] 需要改进

下一步计划: ________________
```

---

## 🎯 本地测试的价值

通过本地测试，你可以：

1. **零成本验证系统** - 不花一分钱确认系统可用性
2. **熟悉操作流程** - 为VPS部署做好准备  
3. **发现配置问题** - 在本地解决所有技术问题
4. **优化用户体验** - 体验完整的用户流程
5. **建立信心** - 确认系统确实可以工作

**预计测试时间**: 30-60分钟  
**成功标准**: 能够通过Telegram Bot完成完整的用户交互流程  
**准备就绪标准**: 所有API正常，用户体验流畅，为VPS部署做好准备

🚀 **开始测试吧！**