# ä¸šåŠ¡æµç¨‹æµ‹è¯•æŒ‡å—

## ðŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜ŽTRONèƒ½é‡åŠ©æ‰‹Botçš„å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•æ–¹æ³•ï¼ŒåŸºäºŽçœŸå®žçš„ä¸‰æ–¹äº¤æ˜“æ¨¡åž‹ï¼š**é¡¾å®¢ â†’ å¹³å° â†’ ä¾›åº”å•†**ã€‚

## ðŸ—ï¸ ä¸šåŠ¡æ¨¡åž‹

### ä¸‰æ–¹è§’è‰²å®šä¹‰

1. **ðŸ‘¤ é¡¾å®¢ï¼ˆCustomerï¼‰**
   - é’±åŒ…åœ°å€: `TCX13dZVJt1uCDCGA3F26KqEndpsSt2CHy`
   - è§’è‰²: æ”¯ä»˜TRXè´­ä¹°èƒ½é‡ç§ŸèµæœåŠ¡
   - é¢„æœŸä½™é¢: 1000 TRX

2. **ðŸ¢ å¹³å°ï¼ˆPlatformï¼‰**  
   - é’±åŒ…åœ°å€: `TAcrAuU78UyPZpZuVPCQo2ZVcfwmkskWLz`
   - è§’è‰²: æŽ¥æ”¶é¡¾å®¢æ”¯ä»˜ï¼Œå¤„ç†è®¢å•ç®¡ç†
   - é¢„æœŸä½™é¢: 7000 TRX

3. **âš¡ ä¾›åº”å•†ï¼ˆSupplierï¼‰**
   - é’±åŒ…åœ°å€: `TVAcKMkSvL8Jbf58AKLnWFesYjiznNUnr4`
   - è§’è‰²: å‘é¡¾å®¢æä¾›å®žé™…çš„èƒ½é‡æœåŠ¡
   - é¢„æœŸä½™é¢: 2000 TRX

### äº¤æ˜“æµç¨‹

```
é¡¾å®¢A --[æ”¯ä»˜TRX]--> å¹³å°B --[åˆ›å»ºè®¢å•]--> ä¾›åº”å•†C
   â†‘                      â†“                    â†“
   â””--[æŽ¥æ”¶Energy]<-------[å¤„ç†è®¢å•]<--[è½¬ç§»Energy]
```

## ðŸ§ª æµ‹è¯•æµç¨‹

### é˜¶æ®µ1: çŽ¯å¢ƒå‡†å¤‡æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´çš„ä¸šåŠ¡æµç¨‹æµ‹è¯•
python business_flow_test.py

# æˆ–è€…è¿è¡Œæ–°çš„æµ‹è¯•æž¶æž„
cd tests
python -m pytest features/ -v
```

#### éªŒè¯é¡¹ç›®
- [ ] åŽç«¯æœåŠ¡å¥åº·æ£€æŸ¥ (localhost:8002/health)
- [ ] Telegram BotæœåŠ¡è¿žæŽ¥
- [ ] TRON Shastaç½‘ç»œè¿žæŽ¥
- [ ] ä¸‰ä¸ªæµ‹è¯•é’±åŒ…ä½™é¢éªŒè¯

### é˜¶æ®µ2: é¡¾å®¢ç«¯æµç¨‹æµ‹è¯•

#### 2.1 å‚æ•°é€‰æ‹©æµ‹è¯•
- [ ] èƒ½é‡æ•°é‡é€‰æ‹©: 135K Energy
- [ ] ç§Ÿç”¨æ—¶é•¿é€‰æ‹©: 1å¤©
- [ ] å‚æ•°ç»„åˆéªŒè¯
- [ ] UIçŠ¶æ€æ›´æ–°

#### 2.2 åœ°å€ç®¡ç†æµ‹è¯•
- [ ] æ·»åŠ é¡¾å®¢é’±åŒ…åœ°å€
- [ ] åœ°å€æ ¼å¼éªŒè¯
- [ ] åœ°å€é€‰æ‹©ç¡®è®¤

#### 2.3 ä½™é¢æŸ¥è¯¢æµ‹è¯•
- [ ] æŸ¥è¯¢é¡¾å®¢é’±åŒ…ä½™é¢
- [ ] éªŒè¯TRXä½™é¢å……è¶³æ€§ (â‰¥ è®¢å•è´¹ç”¨)
- [ ] æ˜¾ç¤ºEnergyå’ŒBandwidthä¿¡æ¯

#### 2.4 è®¢å•æˆæœ¬è®¡ç®—æµ‹è¯•
- [ ] åŸºäºŽå‚æ•°è®¡ç®—è®¢å•è´¹ç”¨
- [ ] éªŒè¯Mockè®¡ç®—ç»“æžœ (~4.86 TRX)
- [ ] æˆæœ¬æ˜¾ç¤ºæ ¼å¼éªŒè¯

### é˜¶æ®µ3: ä¸‰æ–¹äº¤æ˜“æµç¨‹æµ‹è¯•

#### 3.1 è®¢å•åˆ›å»ºæµç¨‹
```
æµ‹è¯•åœºæ™¯: é¡¾å®¢Aè´­ä¹°135K Energyï¼Œç§ŸæœŸ1å¤©

æ­¥éª¤1: é¡¾å®¢ç¡®è®¤è®¢å•å‚æ•°
- èƒ½é‡: 135,000 Energy
- æ—¶é•¿: 1å¤©
- æŽ¥æ”¶åœ°å€: TCX13dZVJt1uCDCGA3F26KqEndpsSt2CHy
- è´¹ç”¨: ~4.86 TRX

æ­¥éª¤2: ç”Ÿæˆæ”¯ä»˜ä¿¡æ¯
- æ”¯ä»˜åœ°å€: TAcrAuU78UyPZpZuVPCQo2ZVcfwmkskWLz (å¹³å°é’±åŒ…)
- æ”¯ä»˜é‡‘é¢: 4.86 TRX
- è®¢å•ID: ç”Ÿæˆå”¯ä¸€è®¢å•æ ‡è¯†
```

#### 3.2 äº¤æ˜“æ‰§è¡Œæµç¨‹ (å½“å‰é™åˆ¶)

**âš ï¸ æ³¨æ„**: ä»¥ä¸‹åŠŸèƒ½å½“å‰æœªå®žçŽ°ï¼Œä»…ä¸ºæµç¨‹è®¾è®¡

```
æ­¥éª¤3: TRXè½¬è´¦æ‰§è¡Œ (æœªå®žçŽ°)
- é¡¾å®¢A â†’ å¹³å°B: è½¬è´¦4.86 TRX
- äº¤æ˜“å“ˆå¸Œè®°å½•
- åŒºå—é“¾ç¡®è®¤ç­‰å¾…

æ­¥éª¤4: å¹³å°å¤„ç† (æœªå®žçŽ°)  
- å¹³å°Bç¡®è®¤æ”¶æ¬¾
- åˆ›å»ºä¾›åº”å•†è®¢å•
- æ›´æ–°è®¢å•çŠ¶æ€ä¸º"å·²æ”¯ä»˜"

æ­¥éª¤5: èƒ½é‡è½¬ç§» (æœªå®žçŽ°)
- ä¾›åº”å•†Cæ‰§è¡ŒEnergy Delegation
- 135K Energy â†’ é¡¾å®¢Aåœ°å€
- èƒ½é‡è½¬ç§»ç¡®è®¤

æ­¥éª¤6: è®¢å•å®Œæˆ (æœªå®žçŽ°)
- ç³»ç»Ÿç¡®è®¤äº¤æ˜“å®Œæˆ
- æ›´æ–°è®¢å•çŠ¶æ€ä¸º"å·²å®Œæˆ"
- å‘é€å®Œæˆé€šçŸ¥
```

### é˜¶æ®µ4: æ•°æ®ä¸€è‡´æ€§éªŒè¯

#### 4.1 äº¤æ˜“å‰åŽä½™é¢å¯¹æ¯”
```
äº¤æ˜“å‰ä½™é¢:
- é¡¾å®¢A: 1000 TRX, 0 Energy
- å¹³å°B: 7000 TRX
- ä¾›åº”å•†C: 2000 TRX, 135K+ Energy

é¢„æœŸäº¤æ˜“åŽä½™é¢:
- é¡¾å®¢A: 995.14 TRX, 135K Energy
- å¹³å°B: 7004.86 TRX  
- ä¾›åº”å•†C: 2000 TRX, åŽŸEnergy - 135K
```

#### 4.2 è®¢å•çŠ¶æ€è·Ÿè¸ª
- [ ] è®¢å•åˆ›å»ºçŠ¶æ€
- [ ] æ”¯ä»˜å¾…ç¡®è®¤çŠ¶æ€
- [ ] æ‰§è¡Œä¸­çŠ¶æ€
- [ ] å·²å®ŒæˆçŠ¶æ€

## ðŸ“Š æµ‹è¯•ç”¨ä¾‹

### æ­£å¸¸æµç¨‹ç”¨ä¾‹

#### ç”¨ä¾‹1: æ ‡å‡†135Kèƒ½é‡1å¤©è®¢å•
```json
{
  "name": "æ ‡å‡†èƒ½é‡ç§Ÿèµè®¢å•",
  "customer": "TCX13dZVJt1uCDCGA3F26KqEndpsSt2CHy",
  "energy_amount": 135000,
  "duration": "1d",
  "expected_cost": 4.86,
  "payment_address": "TAcrAuU78UyPZpZuVPCQo2ZVcfwmkskWLz",
  "supplier": "TVAcKMkSvL8Jbf58AKLnWFesYjiznNUnr4"
}
```

#### ç”¨ä¾‹2: å¤§é¢1Mèƒ½é‡7å¤©è®¢å•
```json
{
  "name": "å¤§é¢é•¿æœŸç§Ÿèµè®¢å•",
  "customer": "TCX13dZVJt1uCDCGA3F26KqEndpsSt2CHy", 
  "energy_amount": 1000000,
  "duration": "7d",
  "expected_cost": 27.0,
  "payment_address": "TAcrAuU78UyPZpZuVPCQo2ZVcfwmkskWLz",
  "supplier": "TVAcKMkSvL8Jbf58AKLnWFesYjiznNUnr4"
}
```

### å¼‚å¸¸æƒ…å†µç”¨ä¾‹

#### ç”¨ä¾‹3: ä½™é¢ä¸è¶³åœºæ™¯
```json
{
  "name": "é¡¾å®¢ä½™é¢ä¸è¶³",
  "issue": "é¡¾å®¢ä½™é¢ < è®¢å•è´¹ç”¨",
  "expected_behavior": "æ˜¾ç¤ºä½™é¢ä¸è¶³é”™è¯¯ï¼Œé˜»æ­¢è®¢å•åˆ›å»º",
  "test_method": "ä¿®æ”¹æµ‹è¯•é’±åŒ…ä½™é¢æˆ–åˆ›å»ºå¤§é¢è®¢å•"
}
```

#### ç”¨ä¾‹4: ç½‘ç»œå¼‚å¸¸åœºæ™¯
```json
{
  "name": "åŒºå—é“¾ç½‘ç»œå¼‚å¸¸",
  "issue": "TRONç½‘ç»œè¿žæŽ¥å¤±è´¥",
  "expected_behavior": "æ˜¾ç¤ºç½‘ç»œé”™è¯¯ï¼Œæä¾›é‡è¯•é€‰é¡¹",
  "test_method": "æ¨¡æ‹Ÿç½‘ç»œæ–­å¼€æˆ–ä½¿ç”¨æ— æ•ˆAPIç«¯ç‚¹"
}
```

## ðŸ”§ æµ‹è¯•å·¥å…·

### è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
```bash
# è¿è¡Œå®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
python tests/business_flow_test.py

# è¿è¡Œç‰¹å®šåŠŸèƒ½æµ‹è¯•
python tests/features/flash_rental/test_flash_rental_ui.py
python tests/features/flash_rental/test_balance_query.py
python tests/features/flash_rental/test_energy_calculation.py
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

#### åŸºç¡€åŠŸèƒ½éªŒè¯
- [ ] é—ªç§Ÿé¡µé¢å¯æ­£å¸¸è®¿é—®
- [ ] å‚æ•°é€‰æ‹©åŠŸèƒ½æ­£å¸¸
- [ ] åœ°å€ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] ä½™é¢æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
- [ ] æˆæœ¬è®¡ç®—æ˜¾ç¤ºæ­£å¸¸

#### é›†æˆåŠŸèƒ½éªŒè¯  
- [ ] åŽç«¯APIè¿žæŽ¥æ­£å¸¸
- [ ] æ•°æ®åº“è¯»å†™æ­£å¸¸
- [ ] TRONç½‘ç»œæŸ¥è¯¢æ­£å¸¸
- [ ] ç”¨æˆ·ä¼šè¯ç®¡ç†æ­£å¸¸

## ðŸ“ˆ é¢„æœŸç»“æžœ

### æˆåŠŸçŽ‡æŒ‡æ ‡
- **åŸºç¡€åŠŸèƒ½**: 100% é€šè¿‡
- **é›†æˆåŠŸèƒ½**: 90%+ é€šè¿‡  
- **ä¸šåŠ¡æµç¨‹**: 70%+ é€šè¿‡ (éƒ¨åˆ†åŠŸèƒ½æœªå®žçŽ°)

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… **å·²å®žçŽ°**: ç•Œé¢äº¤äº’ã€å‚æ•°é€‰æ‹©ã€ä½™é¢æŸ¥è¯¢ã€æˆæœ¬è®¡ç®—
- âš ï¸ **éƒ¨åˆ†å®žçŽ°**: è®¢å•åˆ›å»ºã€çŠ¶æ€ç®¡ç†
- âŒ **æœªå®žçŽ°**: é“¾ä¸Šäº¤æ˜“ã€èƒ½é‡è½¬ç§»ã€æ”¯ä»˜ç¡®è®¤

### å‘çŽ°é—®é¢˜ç±»åž‹
1. **Mockæ•°æ®é™åˆ¶**: æˆæœ¬è®¡ç®—ä½¿ç”¨å‡æ•°æ®
2. **äº¤æ˜“åŠŸèƒ½ç¼ºå¤±**: æ— æ³•æ‰§è¡ŒçœŸå®žTRXè½¬è´¦
3. **èƒ½é‡è½¬ç§»æœªå®žçŽ°**: ç¼ºå°‘Energy Delegationæœºåˆ¶
4. **è®¢å•ç®¡ç†ä¸å®Œæ•´**: çŠ¶æ€è·Ÿè¸ªç³»ç»Ÿå¾…å®Œå–„

## ðŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸä¼˜åŒ– (1-2å‘¨)
1. å®Œå–„æˆæœ¬è®¡ç®—ç®—æ³•ï¼Œæ›¿æ¢Mockæ•°æ®
2. å®žçŽ°è®¢å•æŒä¹…åŒ–å­˜å‚¨
3. æ·»åŠ è®¢å•çŠ¶æ€æŸ¥è¯¢æŽ¥å£
4. ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### ä¸­æœŸå¼€å‘ (1ä¸ªæœˆ)
1. å®žçŽ°TRXè½¬è´¦åŠŸèƒ½
2. é›†æˆEnergy Delegationæœºåˆ¶
3. å®Œå–„ä¸‰æ–¹äº¤æ˜“æµç¨‹
4. æ·»åŠ äº¤æ˜“ç¡®è®¤å’Œé€šçŸ¥

### é•¿æœŸè§„åˆ’ (3ä¸ªæœˆ)
1. å®žçŽ°çœŸå®žå®šä»·ç®—æ³•
2. æ·»åŠ å¸‚åœºæ±‡çŽ‡é›†æˆ
3. å®Œå–„è®¢å•ç®¡ç†ç³»ç»Ÿ
4. æ”¯æŒæ‰¹é‡è®¢å•å¤„ç†

---

*æœ€åŽæ›´æ–°: 2025-09-12*  
*æµ‹è¯•ç‰ˆæœ¬: v2.2.1*