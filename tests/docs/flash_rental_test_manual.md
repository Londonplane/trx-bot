# 闪租页功能测试手册

## 📋 测试概述

闪租页是TRON能量助手Bot的核心功能，提供能量租赁服务的用户界面。本手册详细说明如何测试闪租页的各项功能。

## 🎯 测试范围

### 核心功能测试
1. **参数选择功能**
   - 能量数量选择（65K, 135K, 270K, 540K, 1M）
   - 租用时长选择（1h, 1d, 3d, 7d, 14d）
   - 自定义能量输入

2. **地址管理功能**
   - 添加TRON钱包地址
   - 地址格式验证
   - 地址选择和切换
   - 地址列表管理

3. **余额查询功能**
   - 实时TRX余额查询
   - Energy可用量查询
   - Bandwidth可用量查询
   - 余额更新和缓存

4. **成本计算功能**
   - 基于能量数量和时长的成本计算
   - 时长折扣系数应用
   - 实时价格显示

5. **UI交互功能**
   - 消息实时编辑
   - 按钮状态管理
   - 加载状态提示
   - 错误信息显示

## 🧪 测试方法

### 1. 自动化测试

使用测试脚本进行功能验证：

```bash
# 运行完整的闪租页UI测试
cd tests
python features/flash_rental/test_flash_rental_ui.py

# 运行余额查询测试
python features/flash_rental/test_balance_query.py

# 运行成本计算测试
python features/flash_rental/test_energy_calculation.py
```

### 2. 手动测试

#### 步骤1: 启动服务
```bash
# 1. 启动后端服务
cd backend && python main.py

# 2. 启动Bot服务
cd .. && python main.py
```

#### 步骤2: 功能测试

1. **发送"/start"命令**
   - 验证Bot响应
   - 检查初始界面

2. **选择"⚡ Flash rental"**
   - 进入闪租页面
   - 验证界面显示

3. **测试参数选择**
   - 点击不同能量数量按钮
   - 点击不同租期按钮
   - 验证按钮高亮状态（🔸🔹）
   - 测试"Other amount"自定义输入

4. **测试地址管理**
   - 点击"Select address"
   - 添加测试钱包地址
   - 验证地址格式检查
   - 在不同地址间切换

5. **测试余额查询**
   - 点击"Address balance"
   - 观察加载状态（🔄 Updating balance…）
   - 验证余额信息显示
   - 检查TRX、Energy、Bandwidth数值

6. **验证完整流程**
   - 选择参数→选择地址→查询余额→显示成本
   - 检查最终消息格式

## 📊 测试数据

### 测试钱包信息
- **顾客钱包**: `TCX13dZVJt1uCDCGA3F26KqEndpsSt2CHy` (1000 TRX)
- **平台钱包**: `TAcrAuU78UyPZpZuVPCQo2ZVcfwmkskWLz` (7000 TRX)  
- **供应商钱包**: `TVAcKMkSvL8Jbf58AKLnWFesYjiznNUnr4` (2000 TRX)

### 预期成本计算
- **135K能量1天**: 约4.86 TRX
- **65K能量1小时**: 约2.925 TRX
- **1M能量7天**: 约27.0 TRX

### 测试环境
- **网络**: Shasta测试网
- **后端**: localhost:8002
- **Bot**: 通过Telegram API

## ✅ 验收标准

### 功能正确性
- [ ] 所有参数选择功能正常工作
- [ ] 地址管理支持添加、选择、切换
- [ ] 余额查询显示准确数据
- [ ] 成本计算逻辑正确
- [ ] UI交互流畅无卡顿

### 数据准确性
- [ ] 余额数据与区块链实际数据一致（允许1 TRX误差）
- [ ] 成本计算符合预定算法
- [ ] 地址格式验证准确
- [ ] 消息格式符合规范

### 用户体验
- [ ] 界面响应快速（< 3秒）
- [ ] 错误提示友好明确
- [ ] 加载状态清晰可见
- [ ] 操作流程直观易懂

### 容错能力
- [ ] 网络异常时优雅降级
- [ ] 无效输入正确处理
- [ ] API失败时显示错误信息
- [ ] 重试机制工作正常

## 🐛 常见问题

### 1. 余额查询失败
**现象**: 点击"Address balance"无响应或显示错误
**可能原因**: 
- 后端服务未启动
- TRON网络连接问题
- 地址格式错误

**解决方法**:
- 检查后端服务状态
- 验证网络连接
- 确认地址格式正确

### 2. 成本计算异常
**现象**: 显示的成本明显不合理
**可能原因**:
- Mock数据配置错误
- 计算算法Bug
- 参数传递错误

**解决方法**:
- 检查test_config.py中的Mock配置
- 验证计算逻辑
- 调试参数传递过程

### 3. 地址验证失败
**现象**: 有效的TRON地址被拒绝
**可能原因**:
- 验证规则过严
- 网络配置不匹配
- 地址类型不支持

**解决方法**:
- 检查地址验证逻辑
- 确认网络配置一致
- 验证地址类型支持

## 📈 测试报告

### 报告格式
测试完成后会生成详细的JSON格式报告：

```json
{
  "start_time": "2025-09-12T...",
  "end_time": "2025-09-12T...",
  "summary": {
    "total": 25,
    "passed": 22,
    "failed": 1,
    "skipped": 2
  },
  "success_rate": "88.0%",
  "tests": [...]
}
```

### 关键指标
- **成功率**: 目标 > 90%
- **响应时间**: 目标 < 3秒
- **数据准确性**: 目标 100%
- **错误处理**: 目标覆盖所有异常情况

## 🔄 持续改进

### 测试优化
1. 增加更多边界条件测试
2. 完善性能测试用例
3. 添加压力测试场景
4. 优化测试数据覆盖

### 功能增强
1. 实现真实定价算法替换Mock数据
2. 添加链上交易功能测试
3. 完善订单管理系统测试
4. 增加多用户并发测试

---

*最后更新: 2025-09-12*  
*测试环境: Shasta测试网*